<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      <ion-icon name="chatbubble" slot="start"></ion-icon>
      Reseñas del Lugar
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cargarResenas()" fill="clear">
        <ion-icon name="refresh" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- AGREGAR NUEVA RESEÑA -->
  <ion-card *ngIf="mostrarFormulario">
    <ion-card-header>
      <ion-card-title>Nueva Reseña</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-item fill="outline">
        <ion-label position="stacked">Título</ion-label>
        <ion-input [(ngModel)]="nuevaResena.titulo" placeholder="Ej: Muy buena experiencia"></ion-input>
      </ion-item>

      <ion-item fill="outline">
        <ion-label position="stacked">Contenido</ion-label>
        <ion-textarea [(ngModel)]="nuevaResena.contenido" placeholder="Escribe tu opinión..."></ion-textarea>
      </ion-item>

      <ion-item fill="outline">
        <ion-label position="stacked">Puntuación ({{ nuevaResena.calificacion }}/5)</ion-label>
        <ion-range min="1" max="5" step="1" snaps="true" [(ngModel)]="nuevaResena.calificacion">
          <ion-icon slot="start" name="star-outline"></ion-icon>
          <ion-icon slot="end" name="star"></ion-icon>
        </ion-range>
      </ion-item>

      <div class="form-buttons">
        <ion-button expand="block" (click)="probarAgregarResena()" [disabled]="cargando">
          <ion-icon name="save" slot="start"></ion-icon>
          {{ cargando ? 'Agregando...' : 'Guardar Reseña' }}
        </ion-button>

        <ion-button expand="block" fill="outline" color="medium" (click)="mostrarFormulario = false">
          <ion-icon name="close" slot="start"></ion-icon>
          Cancelar
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- BOTÓN FLOTANTE PARA AGREGAR -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="!mostrarFormulario">
    <ion-fab-button (click)="mostrarFormulario = true" color="primary">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- LISTA DE RESEÑAS -->
  <ion-card *ngIf="resenas.length > 0">
    <ion-card-header>
      <ion-card-title>Reseñas ({{ resenas.length }})</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <ion-list lines="none">
        <ion-item *ngFor="let r of resenas">
          <ion-label>
            <h2>{{ r.texto?.split(':')[0] }}</h2>
            <p>{{ r.texto?.split(':')[1] }}</p>
            <div class="estrellas">
              <ion-icon *ngFor="let s of [1,2,3,4,5]" [name]="s <= r.puntuacion ? 'star' : 'star-outline'" color="warning"></ion-icon>
              <span class="fecha">{{ r.fecha | date:'mediumDate' }}</span>
            </div>
          </ion-label>
          <ion-button fill="clear" color="danger" slot="end" (click)="eliminarResena(r.id_resenas)">
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- SIN RESEÑAS -->
  <div *ngIf="!resenas.length && !mostrarFormulario" class="empty-state">
    <ion-icon name="chatbubble-outline" class="empty-icon"></ion-icon>
    <h3>No hay reseñas aún</h3>
    <ion-button fill="outline" (click)="mostrarFormulario = true">Agregar Reseña</ion-button>
  </div>

  <!-- LOADING -->
  <ion-loading [isOpen]="cargando" message="Procesando..."></ion-loading>
</ion-content>
