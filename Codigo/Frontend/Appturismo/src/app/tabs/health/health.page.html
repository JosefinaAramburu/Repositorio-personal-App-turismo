<div class="resenas-container">
  <h2>Reseñas</h2>

  <!-- Botón para mostrar formulario -->
  <div class="boton-agregar-container">
    <button 
      *ngIf="!mostrarFormulario"
      (click)="toggleFormulario()" 
      class="btn-mostrar-formulario"
    >
      + Agregar Nueva Reseña
    </button>
  </div>

  <!-- Formulario (solo se muestra cuando mostrarFormulario es true) -->
  <div *ngIf="mostrarFormulario" class="agregar-resena">
    <div class="form-header">
      <h3>Agregar Nueva Reseña</h3>
      <button 
        (click)="toggleFormulario()" 
        class="btn-cerrar"
        title="Cerrar formulario"
      >
        ×
      </button>
    </div>
    
    <form (ngSubmit)="agregarResena()" #resenaForm="ngForm">
      
      <!-- Título -->
      <div class="form-group">
        <label for="titulo">Título:</label>
        <input 
          type="text" 
          id="titulo"
          name="titulo" 
          [(ngModel)]="nuevaResena.titulo" 
          required
          class="form-input"
          placeholder="Ej: Excelente experiencia"
        >
      </div>

      <!-- Contenido -->
      <div class="form-group">
        <label for="contenido">Contenido:</label>
        <textarea 
          id="contenido"
          name="contenido" 
          [(ngModel)]="nuevaResena.contenido" 
          required
          rows="4"
          class="form-textarea"
          placeholder="Describe tu experiencia..."
        ></textarea>
      </div>

      <!-- Calificación -->
      <div class="form-group">
        <label for="calificacion">Calificación: {{ nuevaResena.calificacion }}/5</label>
        <div class="calificacion-input">
          <input 
            type="range" 
            id="calificacion"
            name="calificacion" 
            [(ngModel)]="nuevaResena.calificacion" 
            min="1" 
            max="5" 
            required
            class="form-range"
          >
          <div class="estrellas-preview">
            {{ '★'.repeat(nuevaResena.calificacion) }}{{ '☆'.repeat(5 - nuevaResena.calificacion) }}
          </div>
        </div>
      </div>

      <!-- Botones del formulario -->
      <div class="form-buttons">
        <button 
          type="submit" 
          class="btn-submit"
          [disabled]="!resenaForm.valid || cargando"
        >
          {{ cargando ? 'Agregando...' : 'Agregar Reseña' }}
        </button>
        
        <button 
          type="button" 
          (click)="toggleFormulario()"
          class="btn-cancelar"
        >
          Cancelar
        </button>
      </div>

    </form>
  </div>

  <!-- Lista de reseñas -->
  <div class="lista-resenas">
    <h3>Reseñas Existentes ({{ resenas.length }})</h3>

    <div *ngIf="resenas.length === 0" class="sin-resenas">
      <p>No hay reseñas aún. ¡Sé el primero en agregar una!</p>
      <button 
        (click)="toggleFormulario()" 
        class="btn-primera-resena"
      >
        Agregar Primera Reseña
      </button>
    </div>

    <div *ngIf="resenas.length > 0" class="resenas-grid">
      <div *ngFor="let resena of resenas" class="resena-card">
        <div class="resena-header">
          <h4 class="resena-titulo">{{ resena.titulo }}</h4>
          <button 
            (click)="eliminarResena(resena.id)" 
            class="btn-eliminar"
            title="Eliminar reseña"
          >
            ×
          </button>
        </div>
        
        <div class="calificacion-resena">
          <span class="estrellas">
            {{ '★'.repeat(resena.calificacion) }}{{ '☆'.repeat(5 - resena.calificacion) }}
          </span>
          <span class="puntuacion">({{ resena.calificacion }}/5)</span>
        </div>
        
        <p class="contenido-resena">{{ resena.contenido }}</p>
        
        <div class="fecha-resena">
          {{ resena.fecha_creacion | date:'medium' }}
        </div>
      </div>
    </div>
  </div>
</div>