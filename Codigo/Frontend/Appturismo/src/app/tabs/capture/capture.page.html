<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home" text="Atrás"></ion-back-button>
    </ion-buttons>
    <ion-title>Explorar Lugares</ion-title>
    
    <!-- BOTÓN AGREGAR NUEVO -->
    <ion-buttons slot="end">
      <ion-button (click)="agregarLugar()" color="success" title="Agregar nuevo lugar">
        <ion-icon name="add-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="explore-content">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Descubre Lugares Increíbles</h1>
      <p class="hero-subtitle">Encuentra los mejores destinos alrededor del mundo</p>
    </div>
    <div class="hero-gradient"></div>
  </div>

  <!-- Loading State -->
  <div *ngIf="cargando" class="loading-state">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando lugares desde Supabase...</p>
  </div>

  <!-- Search Section -->
  <div *ngIf="!cargando" class="search-section">
    <div class="search-container">
      <ion-searchbar
        [(ngModel)]="terminoBusqueda"
        (ionInput)="filtrarLugares()"
        placeholder=" Buscar ciudad, país o categoría..."
        animated
        clearInput
        class="modern-searchbar">
      </ion-searchbar>
    </div>

    <!-- Location Badge -->
    <div class="location-badge" *ngIf="!terminoBusqueda">
      <ion-icon name="navigate" color="primary"></ion-icon>
      <span>Ubicación actual: <strong>Barcelona, España</strong></span>
    </div>
  </div>

  <!-- Search Results -->
  <div *ngIf="!cargando && lugaresFiltrados.length > 0" class="results-section">
    <div class="section-header">
      <h2>Resultados para "{{terminoBusqueda}}"</h2>
      <span class="results-count">{{lugaresFiltrados.length}} lugar{{lugaresFiltrados.length > 1 ? 'es' : ''}} encontrado{{lugaresFiltrados.length > 1 ? 's' : ''}}</span>
    </div>

    <div class="results-grid">
      <ion-card
        *ngFor="let lugar of lugaresFiltrados"
        class="place-card"
      >
        <div class="card-image-container">
          <div class="image-placeholder" *ngIf="!lugar.imagen">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{lugar.nombre}}</span>
          </div>
          <img
            *ngIf="lugar.imagen"
            [src]="lugar.imagen"
            [alt]="lugar.nombre"
            class="card-image"
            (error)="manejarErrorImagen(lugar)">
          <div class="card-overlay">
            <div class="card-badge">{{lugar.categoria}}</div>
            <div class="rating-badge" *ngIf="lugar.rating">
              <ion-icon name="star" color="warning"></ion-icon>
              <span>{{lugar.rating}}</span>
            </div>
          </div>
        </div>

        <ion-card-header class="card-header">
          <ion-card-title class="place-name">{{lugar.nombre}}</ion-card-title>
          <ion-card-subtitle class="place-location">
            <ion-icon name="location-outline"></ion-icon>
            {{lugar.ciudad}}, {{lugar.pais}}
          </ion-card-subtitle>
        </ion-card-header>

        <ion-card-content class="card-content">
          <p class="place-description">{{lugar.descripcion}}</p>
          
          <div class="place-details">
            <div class="detail-item">
              <ion-icon name="time-outline" color="medium"></ion-icon>
              <span>{{lugar.horario}}</span>
            </div>
            <div class="detail-item" *ngIf="lugar.precio">
              <ion-icon name="card-outline" color="medium"></ion-icon>
              <span>{{lugar.precio}}</span>
            </div>
          </div>

          <!-- BOTONES CRUD -->
          <div class="crud-buttons">
            <ion-button expand="block" color="primary" class="action-button" (click)="irAResenas(lugar)">
              <ion-icon name="chatbubble-ellipses-outline" slot="start"></ion-icon>
              Ver Reseñas
            </ion-button>
            
            <div class="edit-delete-buttons">
              <ion-button size="small" fill="outline" color="warning" 
                         (click)="editarLugar(lugar); $event.stopPropagation()">
                <ion-icon name="create-outline" slot="start"></ion-icon>
                Editar
              </ion-button>
              
              <ion-button size="small" fill="outline" color="danger" 
                         (click)="eliminarLugar(lugar); $event.stopPropagation()">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Eliminar
              </ion-button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Popular Places -->
  <div *ngIf="!cargando && !terminoBusqueda" class="popular-section">
    <div class="section-header">
      <h2>Lugares Populares en Barcelona</h2>
      <p class="section-subtitle">Basado en tu ubicación actual</p>
    </div>

    <div class="popular-grid">
      <ion-card
        *ngFor="let lugar of lugaresPopulares"
        (click)="seleccionarLugar(lugar.nombre)"
        class="popular-card"
      >
        <div class="popular-image-container">
          <div class="image-placeholder small" *ngIf="!lugar.imagen">
            <ion-icon name="location-outline"></ion-icon>
          </div>
          <img
            *ngIf="lugar.imagen"
            [src]="lugar.imagen"
            [alt]="lugar.nombre"
            class="popular-image"
            (error)="manejarErrorImagen(lugar)">
          <div class="popular-overlay">
            <ion-badge color="light">{{lugar.categoria}}</ion-badge>
          </div>
        </div>
       
        <ion-card-content class="popular-content">
          <h3 class="popular-name">{{lugar.nombre}}</h3>
          <p class="popular-location">{{lugar.ciudad}}</p>
          <div class="popular-rating" *ngIf="lugar.rating">
            <ion-icon name="star" color="warning"></ion-icon>
            <span>{{lugar.rating}}</span>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- No Results -->
  <div *ngIf="!cargando && lugaresFiltrados.length === 0 && terminoBusqueda" class="empty-state">
    <div class="empty-content">
      <div class="empty-icon">
        <ion-icon name="search-outline" color="medium"></ion-icon>
      </div>
      <h3>No encontramos resultados</h3>
      <p>No hay lugares que coincidan con "{{terminoBusqueda}}"</p>
      <ion-button fill="outline" color="medium" (click)="terminoBusqueda = ''">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Ver todos los lugares
      </ion-button>
    </div>
  </div>
</ion-content>